import { useState } from "react";
import { Button } from "@/components/ui/button";

const TestsSection = () => {
  const [selectedTest, setSelectedTest] = useState<string | null>(null);
  const [currentQuestion, setCurrentQuestion] = useState(0);
  const [score, setScore] = useState(0);
  const [showResult, setShowResult] = useState(false);
  const [selectedAnswer, setSelectedAnswer] = useState<number | null>(null);
  const [showExplanation, setShowExplanation] = useState(false);

  const testCategories = [
    {
      id: 'ancient',
      title: 'Византийская империя',
      description: 'Тест по истории Византийской империи: вопросы от основания до завоеваний.',
      image: "/lovable-uploads/33a68d1a-eb2b-4587-a6f0-d70969b5c7e9.png",
      questions: [
        {
          question: 'Кто был первым императором Византийской империи?',
          options: ['Юстиниан I', 'Константин I', 'Диоклетиан', 'Феодосий I'],
          correct: 1,
          explanation: 'Константин I Великий стал первым императором Византийской империи, когда перенёс столицу Римской империи в город Византий, который позже был переименован в Константинополь (сейчас Стамбул).'
        },
        {
          question: 'Когда была основана Византийская империя?',
          options: ['395 год', '476 год', '330 год', '529 год'],
          correct: 2,
          explanation: 'Византийская империя фактически начала своё существование, когда император Константин I основал новую столицу, Константинополь, в 330 году.'
        },
        {
          question: 'В каком году Византийская империя была окончательно разрушена, после захвата Константинополя османами?',
          options: ['1204 год', '1453 год', '1492 год', '1397 год'],
          correct: 1,
          explanation: 'Константинополь был захвачен османами 29го мая 1453 года, что ознаменовало конец Византийской империи и начало эпохи Османской империи.'
        },
        {
          question: 'Какой император Византии был известен своими реформами и строительством Храма Святой Софии?',
          options: ['Феодосий I', 'Юстиниан I', 'Александр III', 'Михаил III'],
          correct: 1,
          explanation: 'Юстиниан I был известен своими грандиозными реформами в области права и строительства, включая завершение строительства собора Святой Софии в Константинополе в 537 году.'
        },
        {
          question: 'Какой закон был собран при императоре Юстиниане и стал основой для большинства европейских правовых систем?',
          options: ['Кодекс Юстиниана', 'Триумфальное право', 'Законы Льва', 'Греческие законы'],
          correct: 0,
          explanation: 'Кодекс Юстиниана, или "Corpus Juris Civilis", был основой для многих современных правовых систем и являлся важнейшим достижением Юстиниана I.'
        },
        {
          question: 'Кто был императором Византии во время падения Западной Римской империи в 476 году?',
          options: ['Роман Лакапин', 'Феодосий II', 'Зенон', 'Константин V'],
          correct: 2,
          explanation: 'Зенон был императором Восточной Римской империи (Византии), когда в 476 году варвар Одоакр сместил последнего императора Западной Римской империи Ромула Августа.'
        },
        {
          question: 'Кто был основателем Македонской династии в Византийской империи?',
          options: ['Михаил I', 'Василий I', 'Константин IV', 'Иоанн I'],
          correct: 1,
          explanation: 'Василий I основал династию Македонян в 867 году, которая принесла Византийской империи несколько веков стабильности и процветания.'
        },
        {
          question: 'В каком году произошла битва при Манцикерте, где византийцы потерпели поражение от сельджуков?',
          options: ['1071 год', '1096 год', '1024 год', '1204 год'],
          correct: 0,
          explanation: 'В битве при Манцикерте в 1071 году византийцы потерпели сокрушительное поражение от армии сельджуков.'
        },
        {
          question: 'Кто был последним византийским императором, правившим в Константинополе перед его падением в 1453 году?',
          options: ['Константин XI', 'Мануил II', 'Иоанн VIII', 'Алексей IV'],
          correct: 0,
          explanation: 'Константин XI был последним императором Византийской империи, который погиб в 1453 году, защищая Константинополь от османов.'
        },
        {
          question: 'Какое событие стало причиной появления так называемой "Тёмной эпохи" в Византийской империи после 1204 года?',
          options: [
            'Падение Константинополя в 1204 году',
            'Вторжение персов в 602 году',
            'Чума в 541 году',
            'Переворот 532 года'
          ],
          correct: 0,
          explanation: 'В 1204 году во время Четвёртого крестового похода крестоносцы захватили Константинополь и разграбили его, что привело к временному распаду Византийской империи и началу "Тёмной эпохи".'
        },
        {
          question: 'Кто был императором Византии в период знаменитой битвы при Каталаунских полях в 451 году?',
          options: ['Маркиан', 'Феодосий II', 'Юстиниан I', 'Теодосий I'],
          correct: 0,
          explanation: 'Маркиан был императором Византии, когда произошла битва при Каталаунских полях, в которой союз готов и римлян победил гуннов, возглавляемых Аттилой.'
        },
        {
          question: 'Какой император Византии провел важные религиозные реформы, включая запрет идолопоклонства?',
          options: ['Юстиниан I', 'Лев III Исавр', 'Константин II', 'Алексей I'],
          correct: 1,
          explanation: 'Лев III Исавр был императором, который начал иконоборческую политику, запрещая почитание икон в Византийской империи в 726 году.'
        },
        {
          question: 'В каком году был основан собор Святой Софии, и кто был императором в это время?',
          options: [
            '537 год, Юстиниан I',
            '360 год, Константин I',
            '620 год, Феодосий II',
            '800 год, Карл Великий'
          ],
          correct: 0,
          explanation: 'Собор Святой Софии был завершён в 537 году при императоре Юстиниане I и стал символом мощи Византийской империи и всего христианского мира.'
        },
        {
          question: 'Как называлась система управления в Византии, основанная на феодальном делении и центральном контроле?',
          options: [
            'Протекторат',
            'Теодосийская система',
            'Стратеги и деми',
            'Патриаршая власть'
          ],
          correct: 2,
          explanation: 'В Византийской империи была система, при которой территория делилась на области, называемые "дема", а их защитой и управлением занимались "стратеги".'
        },
        {
          question: 'Кто был последним императором Византии, который вёл борьбу с арабами за контроль над Левантом?',
          options: ['Константин IV', 'Роман Лакапин', 'Михаил III', 'Алексей I'],
          correct: 0,
          explanation: 'Константин IV был императором, который сражался с арабами за контроль над регионами Сирии и Палестины в 660-е годы, включая битву при Акре.'
        },
        {
          question: 'Как назывался великий исторический труд, написанный византийским историком Прокопием Кесарийским?',
          options: [
            'История Византии',
            'История войн',
            'Анналы римской империи',
            'О зданиях'
          ],
          correct: 1,
          explanation: 'Прокопий Кесарийский написал несколько известных работ, включая "Историю войн", которая описывала войны императора Юстиниана I.'
        },
        {
          question: 'Как называлась вторая столица Византийской империи, которая была важным центром для её восточных территорий?',
          options: ['Эдесса', 'Тарс', 'Никомедия', 'Сиракузы'],
          correct: 2,
          explanation: 'Никомедия была второй столицей Византии и важным центром в восточной части империи до того, как Константинополь стал её единственным центром.'
        },
        {
          question: 'Какой город Византийской империи служил стратегически важным пунктом на пути между Европой и Азией?',
          options: ['Никомедия', 'Троя', 'Адрианополь', 'Антиохия'],
          correct: 2,
          explanation: 'Адрианополь (современный Эдирне) был важным городом на границе с варварами и сыграл ключевую роль в обороне Византийской империи.'
        },
        {
          question: 'Кто был первым императором, использовавшим титул "Царь" в Византии?',
          options: ['Константин I', 'Лев III Исавр', 'Ираклий', 'Михаил II'],
          correct: 2,
          explanation: 'Ираклий стал первым византийским императором, который принял титул "Царь" ("Басилеус").'
        },
        {
          question: 'Кто победил в битве при Андрианополе в 378 году, обеспечив себе важные территориальные завоевания?',
          options: [
            'Римская империя',
            'Готы',
            'Сасанидская Персия',
            'Византийская империя'
          ],
          correct: 1,
          explanation: 'В битве при Андрианополе в 378 году готы, под предводительством Фритигерна, разгромили римскую армию, что значительно ослабило Римскую империю.'
        },
        {
          question: 'Какой император Византии провел реформу армии и разделил её на "стратегии"?',
          options: ['Юстиниан I', 'Феодосий II', 'Лев III Исавр', 'Константин II'],
          correct: 2,
          explanation: 'Лев III Исавр реформировал византийскую армию, создав систему "стратегий".'
        },
        {
          question: 'Какой император Византии был первым, кто осудил учение Нестория и утвердил ортодоксальную христианскую доктрину?',
          options: ['Феодосий II', 'Юстиниан I', 'Константин I', 'Лев I'],
          correct: 0,
          explanation: 'Феодосий II был императором, при котором в 431 году был проведён Эфесский собор, осудивший несторианство и утвердивший христианскую доктрину.'
        },
        {
          question: 'В какой битве византийцы победили арабов в 718 году, предотвратив их вторжение в Европу?',
          options: [
            'Битва при Манцикерте',
            'Битва при Левкопетре',
            'Битва при Акре',
            'Битва при Константинополе'
          ],
          correct: 3,
          explanation: 'В 718 году в битве при Константинополе византийцы одержали победу над арабами, что предотвратило их вторжение в Европу.'
        },
        {
          question: 'Какой византийский император является основателем династии Комнинов?',
          options: ['Алексей I', 'Константин IX', 'Михаил VIII', 'Иоанн II'],
          correct: 0,
          explanation: 'Алексей I Комнин стал основателем династии Комнинов в 1081 году.'
        },
        {
          question: 'Когда Византийская империя потеряла контроль над Палестиной и Сирией из-за арабских завоеваний?',
          options: ['609 год', '636 год', '717 год', '800 год'],
          correct: 1,
          explanation: 'В 636 году в битве при Ярмуке арабские войска разгромили византийцев, захватив Палестину и Сирию.'
        },
        {
          question: 'Какое событие в истории Византийской империи произошло в 1054 году и привело к Великому расколу?',
          options: [
            'Захват Константинополя',
            'Эдесса взята крестьянами',
            'Разделение церкви на католическую и православную',
            'Установление династии Палеологов'
          ],
          correct: 2,
          explanation: 'В 1054 году случился церковный кризис – единая церковь разделилась на западную католическую и восточную православную.'
        },
        {
          question: 'В каком году был проведён Эфесский собор, на котором была осуждена ересь Нестория?',
          options: ['431 год', '451 год', '493 год', '510 год'],
          correct: 0,
          explanation: 'Эфесский собор, проведённый в 431 году, осудил несторианство, учение, утверждавшее существование двух личностей в Христе.'
        },
        {
          question: 'Какая форма правления была в Византии после разделения Римской империи в 395 году?',
          options: ['Олигархия', 'Монархия', 'Теократия', 'Республика'],
          correct: 1,
          explanation: 'После разделения Римской империи в 395 году Византия продолжала существовать как монархия с императором-лидером.'
        },
        {
          question: 'Кто был основным архитектором знаменитого собора Святой Софии в Константинополе?',
          options: [
            'Исидор Милетский и Анфимий Траллий',
            'Прокопий Кесарийский',
            'Лев III Исавр',
            'Михаил VIII Палеолог'
          ],
          correct: 0,
          explanation: 'Собор Святой Софии был спроектирован Исидором Милетским и Анфимием Траллийским.'
        },
        {
          question: 'Какой император Византии провёл реформу военной службы, внедрив систему тематик?',
          options: ['Константин I', 'Юстиниан I', 'Ираклий', 'Лев III Исавр'],
          correct: 2,
          explanation: 'Ираклий провёл реформу армии, введя систему "тематик", что укрепило обороноспособность империи.'
        },
        {
          question: 'Как называлась война, в которой Византия потерпела крупное поражение от персов в VII веке?',
          options: [
            'Греко-персидская война',
            'Персидская кампания',
            'Война с Сасанидами',
            'Война с арабами'
          ],
          correct: 2,
          explanation: 'В VII веке Византия вела тяжёлую войну с Сасанидской Персией, потеряв значительные территории.'
        },
        {
          question: 'Какой византийский император был первым, кто принял титул "автократор"?',
          options: [
            'Ираклий',
            'Константин I',
            'Михаил VIII Палеолог',
            'Алексиус I Комнин'
          ],
          correct: 0,
          explanation: 'Ираклий стал первым византийским императором, который принял титул "автократор".'
        },
        {
          question: 'Как называлась система власти в Византии, где верховный император был и главой государства, и церкви?',
          options: [
            'Теократическая монархия',
            'Абсолютная монархия',
            'Республиканская демократия',
            'Папская монархия'
          ],
          correct: 0,
          explanation: 'В Византии существовала теократическая монархия: император был и светским, и духовным главой.'
        },
        {
          question: 'Какую победу одержал византийский император Юстиниан I над вандалами в Северной Африке?',
          options: [
            'Битва при Нарсе',
            'Битва при Греции',
            'Завоевание Карфагена',
            'Победа при Триглапе'
          ],
          correct: 2,
          explanation: 'В 533 году Юстиниан I отправил Велизария в Африку, где был разгромлен вандальский король, а Карфаген стал византийским.'
        },
        {
          question: 'В каком году Византия утратила свои последние земли в Италии?',
          options: ['1030 год', '1071 год', '1261 год', '1453 год'],
          correct: 1,
          explanation: 'Византия утратила город Бари в 1071 году из-за норманнов, полностью изгнавших византийцев с полуострова.'
        },
        {
          question: 'Как назывался титул, который византийский император использовал для обозначения духовной власти?',
          options: ['Папа', 'Автократор', 'Базилеус', 'Патриарх'],
          correct: 2,
          explanation: 'Титул "базилеус" использовался византийскими императорами как в светской, так и в духовной сфере.'
        },
        {
          question: 'В каком году Византия потеряла контроль над Балканами из-за наступления османов?',
          options: ['1453 год', '1261 год', '1396 год', '1389 год'],
          correct: 2,
          explanation: 'В 1396 году османы победили при Никополе, что ознаменовало господство на Балканах и ослабление Византии.'
        },
        {
          question: 'Какое важное соглашение было подписано в 843 году, восстанавливающее иконопочитание в Византии?',
          options: [
            'Софийский договор',
            'Мир в Вердене',
            'Эфесский собор',
            'Восстановление икон'
          ],
          correct: 3,
          explanation: 'В 843 году в Византии было восстановлено иконопочитание, закреплённое на VII Вселенском соборе ("Победа православия").'
        },
        {
          question: 'Какой византийский император завершил завоевание Италии, включив Сицилию и Сардинию?',
          options: [
            'Юстиниан I',
            'Константин I',
            'Алексей I Комнин',
            'Феодосий II'
          ],
          correct: 0,
          explanation: 'Юстиниан I в ходе войн с вандалами и остготами завоевал Сицилию и Сардинию, укрепив византийский контроль в Средиземноморье.'
        },
        {
          question: 'Какое событие произошло в 1204 году, что привело к падению Константинополя и образованию Латинской империи?',
          options: [
            'Взятие города крестоносцами',
            'Нападение османов',
            'Пожар в Константинополе',
            'Открытие новой торговой пути'
          ],
          correct: 0,
          explanation: 'В 1204 году крестоносцы захватили и разграбили Константинополь, что привело к созданию Латинской империи.'
        }
      ]
    },
    {
      id: 'world-wars',
      title: 'World Wars',
      description: 'Test your knowledge of the World Wars',
      questions: [
        {
          question: 'When did World War I begin?',
          options: ['1914', '1915', '1916', '1917'],
          correct: 0,
          explanation: 'World War I began on July 28, 1914, following the assassination of Archduke Franz Ferdinand.'
        }
      ]
    },
    {
      id: 'golden-horde',
      title: 'Тест по истории Золотой Орды',
      description: 'Проверьте свои знания о Золотой Орде, её правителях, битвах и наследии.',
      image: "/lovable-uploads/d170a14e-a3d4-4a86-9447-793558c69e7e.png",
      questions: [
        {
          question: 'Кто был первым великим ханом Золотой Орды?',
          options: ['Тохтамыш', 'Бату', 'Узбек', 'Бердибек'],
          correct: 1,
          explanation: 'Бату был основателем Золотой Орды, внуком Чингисхана. Он возглавил монгольские войска, которые в 1237-1240 годах завоевали Русь, после чего был провозглашен великим ханом Золотой Орды.'
        },
        {
          question: 'Какое значение для Золотой Орды имел правление Узбек-хана?',
          options: ['Он значительно расширил территорию Орды, включая Среднюю Азию', 'Он утвердил ислам как государственную религию', 'Он заключил мир с Китаем', 'Он ввел систему налогов и поборов с покорённых народов'],
          correct: 1,
          explanation: 'Узбек-хан (1312–1341) утвердил ислам как государственную религию Золотой Орды, что оказало большое влияние на культуру и религиозную жизнь государства.'
        },
        {
          question: 'Что было результатом Куликовской битвы для Золотой Орды?',
          options: ['Римская империя потеряла свою власть', 'Победа Золотой Орды укрепила ее влияние в Восточной Европе', 'Поражение Золотой Орды ослабило ее власть над Русью', 'Золотая Орда заключила мир с Великой Литвой'],
          correct: 2,
          explanation: 'Поражение в Куликовской битве стало важной вехой в ослаблении влияния Золотой Орды на Русь, несмотря на то что Орда смогла сохранить свою власть на долгое время.'
        },
        {
          question: 'Какой хан Золотой Орды пытался восстановить ордынскую власть на Руси после поражения в Куликовской битве?',
          options: ['Тохтамыш', 'Бердибек', 'Узбек', 'Ногай'],
          correct: 0,
          explanation: 'Тохтамыш в 1382 году, после поражения в Куликовской битве, совершил успешный поход на Русь и разрушил Москву, чтобы восстановить ордынское владычество.'
        },
        {
          question: 'Какую роль сыграли монголы в русской политике в XIII-XIV веках?',
          options: ['Они пытались полностью уничтожить Русь', 'Они ставили русских князей править в своих княжествах, а те должны были платить им дань', 'Они окончательно укрепили единство русских земель', 'Они создали союз с русскими князьями против Литвы'],
          correct: 1,
          explanation: 'Монголы, захватив Русь, оставили её князей в роли вассалов и требовали регулярную дань, что обеспечивало Орде контроль над русскими землями.'
        },
        {
          question: 'Какую роль в борьбе против Золотой Орды сыграл Ногай?',
          options: ['Он был союзником Дмитрия Донского', 'Он возглавил восстание против монголов', 'Он основал независимое Ногайское ханство, которое выступало против Орды', 'Он захватил все территории, которые ранее принадлежали Орде'],
          correct: 2,
          explanation: 'Ногай, выдающийся полководец, в 1270х годах стал фактически независимым ханом собственного улуса от Золотой Орды, после чего начал активно сражаться против ханов всей орды.'
        },
        {
          question: 'Какое значение имел поход Тамерлана (Тимура) в 1395 году для Золотой Орды?',
          options: ['Тамерлан восстановил могущество Орды', 'Тамерлан разгромил Тохтамыша и разрушил значительную часть Золотой Орды', 'Тамерлан заключил мирный договор с Ордынскими ханами', 'Тамерлан стал союзником Золотой Орды в борьбе с Литвой'],
          correct: 1,
          explanation: 'В 1395 году Тамерлан (Тимур) нанес сокрушительное поражение Тохтамышу, разрушив Орду и нанеся ей такие потери, что она уже не смогла восстановить прежнее могущество.'
        },
        {
          question: 'Что привело к распаду Золотой Орды в начале XV века?',
          options: ['Война с Китаем', 'Внутренние раздоры и борьба за власть', 'Восстание русских князей', 'Ослабление Орды в результате болезней и голода'],
          correct: 1,
          explanation: 'Внутренние конфликты между претендентами на трон и борьба за власть между различными ханами привели к распаду Золотой Орды в начале XV века.'
        },
        {
          question: 'Что происходило с экономикой Золотой Орды в период её упадка?',
          options: ['Экономика продолжала процветать благодаря торговле с Востоком', 'Состоялась реформа налоговой системы, укрепившая государство', 'Торговля прекратилась, а экономика пришла в упадок', 'Золотая Орда значительно усилила свои финансовые ресурсы за счёт рабства'],
          correct: 2,
          explanation: 'Из-за внутренних конфликтов и нашествия Тамерлана города Золотой Орды были полностью разрушены вместе с ключевыми торговыми путями, что способствовало экономическому упадку.'
        },
        {
          question: 'Что стало с территорией Золотой Орды после распада?',
          options: ['Золотая Орда разделилась на несколько независимых ханств', 'Орда была захвачена Литвой', 'Все территории были присоединены к Московии', 'Орда была присоединена к Османской империи'],
          correct: 0,
          explanation: 'После распада Золотой Орды её территория была разделена между несколькими независимыми ханствами, такими как Казанское, Крымское, Астраханское и другие, которые позже стали частью различных государств.'
        },
        {
          question: 'Что стало важным результатом курултая 1269 года в Золотой Орде?',
          options: ['Принятие решения о завоеваниях на территории России', 'Провозглашение Золотой Орды независимой от остальной части Монгольской Империи', 'Принятие христианства в качестве государственной религии Орды', 'Заключение союза с Египетским султанатом против Ливии'],
          correct: 1,
          explanation: 'Курултай 1269 года был важным событием, на котором было официально провозглашено о независимости Золотой Орды от остальной части Монгольской Империи, что закрепило её статус как самостоятельного государства.'
        },
        {
          question: 'Какие отношения существовали между Рубруком и Золотой Ордой в XIII веке?',
          options: ['Рубрук был послом Золотой Орды, направленным к Франции', 'Рубрук был первым европейцем, посетившим столицу Золотой Орды', 'Рубрук заключил важный торговый договор с монголами', 'Рубрук был ученым, который обучал ханов Орды западной науке'],
          correct: 1,
          explanation: 'В 1253 году французский путешественник и монах Вильгельм Рубрук был первым европейцем, посетившим столицу Золотой Орды, Сарай Бату, где он вел переговоры с ханом Бату и зафиксировал свои наблюдения о культуре и жизни Орды.'
        },
        {
          question: 'Какое значение имел Берке-хан для истории Золотой Орды?',
          options: ['Он восстановил ордынскую власть в Европе после Великой Замятни', 'Он стал первым ханом, принявшим ислам как государственную религию', 'Он утвердил династию, правившую Золотой Ордой до её распада', 'Он стал первым правителем, заключившим союз с Египетским султанатом'],
          correct: 1,
          explanation: 'Берке-хан сыграл ключевую роль в укреплении Золотой Орды, в том числе став первым ханом, который принял ислам как официальную религию, что оказало большое влияние на культуру и политику Орды в дальнейшем.'
        },
        {
          question: 'Как называлась столица Золотой Орды?',
          options: ['Сарай', 'Бухара', 'Кафы', 'Волжский Сарай'],
          correct: 0,
          explanation: 'Сарай был главной столицей Золотой Орды, а затем Волжский Сарай стал важнейшим политическим и экономическим центром.'
        },
        {
          question: 'Когда произошло знаменитое сражение на реке Калке?',
          options: ['1223 год', '1240 год', '1255 год', '1237 год'],
          correct: 0,
          explanation: 'Битва на реке Калке стала одной из первых побед монголов над русскими княжествами, хотя это сражение происходило ещё до основания Золотой Орды.'
        },
        {
          question: 'Как назывался крупный портовый город, находившийся на территории Золотой Орды и являвшийся важным торговым центром?',
          options: ['Кафы', 'Новгород', 'Сарай', 'Казань'],
          correct: 0,
          explanation: 'Кафы (современная Феодосия) была важнейшим торговым городом на побережье Черного моря, через который шли товары из Европы в Азию.'
        },
        {
          question: 'В каком году состоялось знаменитая Куликовская битва?',
          options: ['1380 год', '1378 год', '1395 год', '1400 год'],
          correct: 0,
          explanation: 'Куликовская битва, в которой войска Дмитрия Донского одержали победу над монголами Мамая, стала важным событием в истории России и ослабила власть Орды в регионе.'
        },
        {
          question: 'Какой хан Золотой Орды укрепил её власть, значительно улучшив отношения с Египтом и другими мусульманскими государствами?',
          options: ['Берке', 'Джанибек', 'Батый', 'Сартач'],
          correct: 0,
          explanation: 'Берке хан наладил тесные связи с мусульманскими странами для борьбы против общего врага и налаживанию торговли.'
        },
        {
          question: 'Кто был правителем Московии во время Куликовской битвы?',
          options: ['Иван Калита', 'Дмитрий Донской', 'Иван III', 'Алексей Михайлович'],
          correct: 1,
          explanation: 'Дмитрий Донской был великим князем Московским и возглавил русское войско в знаменитом сражении на Куликовом поле против татар.'
        },
        {
          question: 'Какая из этих культур оказала наибольшее влияние на Золотую Орду?',
          options: ['Китайская', 'Византийская', 'Исламская', 'Латинская'],
          correct: 2,
          explanation: 'Влияние ислама на Золотую Орду было значительным, особенно после того, как Узбек хан сделал ислам государственной религией, что изменило социальную и культурную структуру государства.'
        },
        {
          question: 'Из-за какого хана в Европе началась эпидемия “черной смерти”?',
          options: ['Улугбек', 'Батый', 'Джанибек', 'Тохтамыш'],
          correct: 2,
          explanation: 'Джанибек в 1346 году осадил город генуэзцев Каффу, но в его войске началась эпидемия чумы и хан приказал тела умерших катапультами забрасывать в город, после чего корабли дальше разнесли болезнь по всей Европе.'
        },
        {
          question: 'Из-за чего началась “Великая замятня” в Золотой Орде?',
          options: ['Из-за нашествия Тамерлана', 'Из-за убийства Бердибека', 'Поражение от Руси', 'Экономического кризиса'],
          correct: 1,
          explanation: 'Великая замятня, которая длилась с 1359 по 1380 год из-за время которой сменилось 25 ханов началось из-за того, что в 1359 году хана Золотой Орды Бердибека убили в ходе заговора.'
        }
      ]
    }
  ];

  const currentTest = testCategories.find(test => test.id === selectedTest);
  const currentQuestionData = currentTest?.questions[currentQuestion];

  const handleAnswerSelect = (answerIndex: number) => {
    setSelectedAnswer(answerIndex);
    setShowExplanation(true);
    
    if (answerIndex === currentQuestionData?.correct) {
      setScore(score + 1);
    }
  };

  const handleNextQuestion = () => {
    if (currentTest && currentQuestion < currentTest.questions.length - 1) {
      setCurrentQuestion(currentQuestion + 1);
      setSelectedAnswer(null);
      setShowExplanation(false);
    } else {
      setShowResult(true);
    }
  };

  const resetTest = () => {
    setSelectedTest(null);
    setCurrentQuestion(0);
    setScore(0);
    setShowResult(false);
    setSelectedAnswer(null);
    setShowExplanation(false);
  };

  if (showResult && currentTest) {
    return (
      <section className="bg-gray-50 py-16 px-6 min-h-screen">
        <div className="max-w-4xl mx-auto text-center">
          <h2 className="text-4xl font-bold text-gray-800 mb-8">Test Complete!</h2>
          <div className="bg-white rounded-lg p-8 shadow-lg">
            <h3 className="text-2xl font-semibold mb-4">{currentTest.title}</h3>
            <p className="text-6xl font-bold text-purple-600 mb-4">
              {score}/{currentTest.questions.length}
            </p>
            <p className="text-xl text-gray-600 mb-8">
              You scored {Math.round((score / currentTest.questions.length) * 100)}%
            </p>
            <div className="space-x-4">
              <Button 
                onClick={resetTest}
                className="bg-purple-600 hover:bg-purple-700 text-white px-8 py-3"
              >
                Take Another Test
              </Button>
              <Button 
                onClick={() => setShowResult(false)}
                variant="outline"
                className="px-8 py-3"
              >
                Review Answers
              </Button>
            </div>
          </div>
        </div>
      </section>
    );
  }

  if (selectedTest && currentTest && currentQuestionData) {
    return (
      <section className="bg-gray-50 py-16 px-6 min-h-screen">
        <div className="max-w-4xl mx-auto">
          <div className="mb-8">
            <button 
              onClick={resetTest}
              className="text-purple-600 hover:text-purple-700 mb-4"
            >
              ← Back to Tests
            </button>
            <div className="flex justify-between items-center">
              <h2 className="text-3xl font-bold text-gray-800">{currentTest.title}</h2>
              <span className="text-gray-600">
                Question {currentQuestion + 1} of {currentTest.questions.length}
              </span>
            </div>
          </div>

          <div className="bg-white rounded-lg p-8 shadow-lg">
            <h3 className="text-xl font-semibold mb-6">{currentQuestionData.question}</h3>
            
            <div className="space-y-4">
              {currentQuestionData.options.map((option, index) => (
                <button
                  key={index}
                  onClick={() => !showExplanation && handleAnswerSelect(index)}
                  disabled={showExplanation}
                  className={`w-full text-left p-4 rounded-lg border transition-colors ${
                    showExplanation
                      ? index === currentQuestionData.correct
                        ? 'bg-green-100 border-green-500 text-green-800'
                        : selectedAnswer === index
                        ? 'bg-red-100 border-red-500 text-red-800'
                        : 'bg-gray-100 border-gray-300'
                      : selectedAnswer === index
                      ? 'bg-purple-100 border-purple-500'
                      : 'bg-gray-50 border-gray-300 hover:bg-gray-100'
                  }`}
                >
                  {option}
                </button>
              ))}
            </div>

            {showExplanation && (
              <div className="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <h4 className="font-semibold text-blue-800 mb-2">Explanation:</h4>
                <p className="text-blue-700">{currentQuestionData.explanation}</p>
                <Button 
                  onClick={handleNextQuestion}
                  className="mt-4 bg-purple-600 hover:bg-purple-700 text-white"
                >
                  {currentQuestion < currentTest.questions.length - 1 ? 'Next Question' : 'See Results'}
                </Button>
              </div>
            )}
          </div>
        </div>
      </section>
    );
  }

  return (
    <section className="bg-gray-50 py-16 px-6 min-h-screen">
      <div className="max-w-7xl mx-auto">
        <div className="text-center mb-16">
          <h2 className="text-4xl font-bold text-gray-800 mb-6">History Tests</h2>
          <p className="text-xl text-gray-600 max-w-3xl mx-auto">
            Test your knowledge with our interactive quizzes. Each test provides immediate feedback 
            and explanations to help you learn.
          </p>
        </div>

        <div className="grid md:grid-cols-3 gap-8">
          {testCategories.map((category) => (
            <div key={category.id} className="bg-white rounded-lg p-6 shadow-lg hover:shadow-xl transition-shadow">
              <h3 className="text-xl font-bold text-gray-800 mb-4">{category.title}</h3>
              <p className="text-gray-600 mb-6">{category.description}</p>
              <p className="text-sm text-gray-500 mb-4">
                {category.questions.length} Questions
              </p>
              <Button 
                onClick={() => setSelectedTest(category.id)}
                className="w-full bg-purple-600 hover:bg-purple-700 text-white"
              >
                Start Test
              </Button>
            </div>
          ))}
        </div>
      </div>
    </section>
  );
};

export default TestsSection;
